{% extends 'index.html' %}
{% load crispy_forms_tags %}

{% block start %}
<h2>Make Query: {{ query.name }}</h2>

<form method="post">
  {% csrf_token %}
  {{ form|crispy }}
  <button type="submit" class="btn btn-success">Go</button>
</form>

<hr class="my-4">

<div class="mt-4">
  <table class="table table-striped table-hover table-bordered align-middle">
    <thead class="table-dark">
      <tr>
        <th scope="col">When was executed</th>
        <th scope="col">How long (s)</th>
        <th scope="col">Parameters</th>
        <th scope="col">Link</th>
      </tr>
    </thead>
    <tbody>
      {% for i in requests %}
      <tr>
        <td>{{ i.created_at|date:"Y-m-d H:i:s" }}</td>
        <td>{{ i.response_time|floatformat:2 }}</td>
        <td>
            {% for key, value in i.parameters.items %}
              <b>{{ key  }}</b>: {{ value }}, 
            {% endfor %}
        </td>
        <td>
          <a href="{% url 'repeat_request' i.id %}" class="btn btn-primary">Go to Query</a>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="3" class="text-center">No requests found</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock %}